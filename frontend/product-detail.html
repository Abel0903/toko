<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detail Produk - TokoPro</title>
    <link rel="stylesheet" href="assets/style.css">
</head>
<body>
    <!-- Header -->
    <header>
        <nav>
            <a href="/" class="logo">TokoPro</a>
            <ul class="nav-links">
                <li><a href="/">Beranda</a></li>
                <li><a href="/products.html">Produk</a></li>
                <li><a href="/about.html">Tentang</a></li>
                <li><a href="/contact.html">Kontak</a></li>
            </ul>
            <div class="auth-buttons">
                <button class="btn btn-secondary" onclick="goToCart()">üõí <span id="cart-count">0</span></button>
            </div>
        </nav>
    </header>

    <div class="container" style="padding: 2rem 0; margin-bottom: 3rem;">
        <a href="/products.html" style="color: #2563eb; text-decoration: none; margin-bottom: 1rem; display: inline-block;">‚Üê Kembali ke Produk</a>

        <div id="alert-container"></div>

        <div class="flex gap-6" style="flex-wrap: wrap; margin-top: 2rem;">
            <!-- Product Image -->
            <div style="flex: 1; min-width: 300px;">
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); width: 100%; height: 400px; border-radius: 0.75rem; display: flex; align-items: center; justify-content: center; color: white; font-size: 5rem;">
                    üì¶
                </div>
            </div>

            <!-- Product Info -->
            <div style="flex: 1; min-width: 300px;">
                <h1 id="product-name" style="margin-top: 0;"></h1>
                
                <div style="margin: 1rem 0; padding: 1rem; background: #f3f4f6; border-radius: 0.5rem;">
                    <div style="font-size: 2rem; font-weight: 700; color: #2563eb; margin-bottom: 1rem;">
                        <span id="product-price"></span>
                    </div>
                    <div style="color: #6b7280;">
                        <p id="product-stock"></p>
                    </div>
                </div>

                <div style="margin: 1.5rem 0;">
                    <h3>Deskripsi Produk</h3>
                    <p id="product-description" style="color: #6b7280; line-height: 1.6;"></p>
                </div>

                <div class="flex gap-4" style="margin: 2rem 0;">
                    <div style="flex: 1;">
                        <label>Jumlah</label>
                        <input type="number" id="quantity" min="1" value="1" style="width: 100%; padding: 0.75rem; border: 1px solid #e5e7eb; border-radius: 0.5rem; font-size: 1rem;">
                    </div>
                </div>

                <button class="btn btn-primary btn-block btn-lg" onclick="addToCartWithQty()" id="add-to-cart-btn">Tambah ke Keranjang</button>
                <button class="btn btn-secondary btn-block" style="margin-top: 0.5rem;" onclick="window.location.href='/products.html'">Lanjut Belanja</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer style="background: #1f2937; color: white; padding: 2rem; text-align: center; margin-top: 3rem;">
        <p>&copy; 2024 TokoPro. Semua hak dilindungi.</p>
    </footer>

    <script src="assets/api.js"></script>
    <script>
        let currentProduct = null;

        window.addEventListener('load', () => {
            const params = new URLSearchParams(window.location.search);
            const productId = params.get('id');

            if (!productId) {
                showAlert('Produk tidak ditemukan', 'danger');
                setTimeout(() => window.location.href = '/products.html', 2000);
                return;
            }

            loadProduct(productId);
            updateCartCount();
        });

        async function loadProduct(id) {
            try {
                const data = await productAPI.getById(id);
                currentProduct = data.data;

                document.getElementById('product-name').textContent = currentProduct.name;
                document.getElementById('product-price').textContent = formatCurrency(currentProduct.price);
                document.getElementById('product-description').textContent = currentProduct.description || 'Produk berkualitas dari TokoPro';
                
                if (currentProduct.stock > 0) {
                    document.getElementById('product-stock').innerHTML = `
                        <strong style="color: #16a34a;">‚úì Stock tersedia: ${currentProduct.stock} unit</strong>
                    `;
                    document.getElementById('add-to-cart-btn').disabled = false;
                } else {
                    document.getElementById('product-stock').innerHTML = `
                        <strong style="color: #dc2626;">‚úó Produk sedang habis</strong>
                    `;
                    document.getElementById('add-to-cart-btn').disabled = true;
                    document.getElementById('quantity').disabled = true;
                }
            } catch (error) {
                showAlert('Gagal memuat produk: ' + error.message, 'danger');
            }
        }

        function addToCartWithQty() {
            if (!currentProduct) return;

            const qty = parseInt(document.getElementById('quantity').value);

            if (qty <= 0 || qty > currentProduct.stock) {
                showAlert('Jumlah tidak valid', 'danger');
                return;
            }

            const item = {
                id: currentProduct.id,
                name: currentProduct.name,
                price: currentProduct.price,
                stock: currentProduct.stock,
                quantity: qty
            };

            cartAPI.addToCart(item);
            updateCartCount();
            showAlert('Produk ditambahkan ke keranjang', 'success');
        }

        function goToCart() {
            window.location.href = '/cart.html';
        }

        function updateCartCount() {
            document.getElementById('cart-count').textContent = cartAPI.getItemCount();
        }

        function showAlert(message, type) {
            const container = document.getElementById('alert-container');
            container.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
        }
    </script>
</body>
</html>
