<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Produk - TokoPro</title>
    <link rel="stylesheet" href="assets/style.css">
</head>
<body>
    <!-- Header & Navigation -->
    <header>
        <nav>
            <a href="/" class="logo">TokoPro</a>
            <ul class="nav-links">
                <li><a href="/">Beranda</a></li>
                <li><a href="/products.html">Produk</a></li>
                <li><a href="/about.html">Tentang</a></li>
                <li><a href="/contact.html">Kontak</a></li>
            </ul>
            <div class="auth-buttons">
                <button class="btn btn-secondary" onclick="goToCart()">ðŸ›’ <span id="cart-count">0</span></button>
                <button class="btn btn-secondary" id="auth-btn">Login</button>
            </div>
        </nav>
    </header>

    <div class="container" style="padding: 2rem 0; margin-bottom: 3rem;">
        <h1 style="margin-bottom: 2rem;">Daftar Produk</h1>

        <!-- Search & Filter -->
        <div class="card" style="padding: 1.5rem; margin-bottom: 2rem;">
            <div class="flex gap-4" style="flex-wrap: wrap;">
                <div style="flex: 1; min-width: 200px;">
                    <input type="text" id="search-input" placeholder="Cari produk..." style="width: 100%; padding: 0.75rem; border: 1px solid #e5e7eb; border-radius: 0.5rem;">
                </div>
                <div style="flex: 1; min-width: 150px;">
                    <select id="sort-select" style="width: 100%; padding: 0.75rem; border: 1px solid #e5e7eb; border-radius: 0.5rem;">
                        <option value="">Urutkan Berdasarkan</option>
                        <option value="name">Nama (A-Z)</option>
                        <option value="price-asc">Harga (Terendah)</option>
                        <option value="price-desc">Harga (Tertinggi)</option>
                        <option value="stock">Stock (Terbanyak)</option>
                    </select>
                </div>
                <button class="btn btn-secondary" onclick="resetFilters()">Reset</button>
            </div>
        </div>

        <!-- Products Grid -->
        <div class="products-grid" id="products-container">
            <div class="card" style="padding: 2rem; text-align: center; grid-column: 1/-1;">
                <div class="spinner"></div>
                <p>Memuat produk...</p>
            </div>
        </div>

        <!-- Pagination -->
        <div class="pagination" id="pagination"></div>
    </div>

    <!-- Footer -->
    <footer style="background: #1f2937; color: white; padding: 2rem; text-align: center;">
        <div class="container">
            <p>&copy; 2024 TokoPro. Semua hak dilindungi.</p>
        </div>
    </footer>

    <script src="assets/api.js"></script>
    <script>
        let allProducts = [];
        let filteredProducts = [];
        let currentPage = 1;
        const itemsPerPage = 12;

        async function loadProducts() {
            try {
                const data = await productAPI.getAll();
                allProducts = data.data || [];
                filteredProducts = allProducts;
                renderProducts();
                renderPagination();
            } catch (error) {
                console.error('Error loading products:', error);
                document.getElementById('products-container').innerHTML = '<div class="alert alert-danger">Gagal memuat produk</div>';
            }
        }

        function filterAndSort() {
            const search = document.getElementById('search-input').value.toLowerCase();
            const sort = document.getElementById('sort-select').value;

            filteredProducts = allProducts.filter(p => 
                p.name.toLowerCase().includes(search) ||
                (p.description && p.description.toLowerCase().includes(search))
            );

            if (sort === 'name') {
                filteredProducts.sort((a, b) => a.name.localeCompare(b.name));
            } else if (sort === 'price-asc') {
                filteredProducts.sort((a, b) => a.price - b.price);
            } else if (sort === 'price-desc') {
                filteredProducts.sort((a, b) => b.price - a.price);
            } else if (sort === 'stock') {
                filteredProducts.sort((a, b) => b.stock - a.stock);
            }

            currentPage = 1;
            renderProducts();
            renderPagination();
        }

        function renderProducts() {
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageProducts = filteredProducts.slice(start, end);

            if (pageProducts.length === 0) {
                document.getElementById('products-container').innerHTML = '<div class="card" style="grid-column: 1/-1; padding: 2rem; text-align: center;">Tidak ada produk yang ditemukan</div>';
                return;
            }

            const html = pageProducts.map(product => `
                <div class="product-card">
                    <div class="product-image">
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: white; font-size: 3rem;">
                            ðŸ“¦
                        </div>
                    </div>
                    <div class="product-info">
                        <div class="product-name">${product.name}</div>
                        <div class="product-description">${product.description || 'Produk berkualitas'}</div>
                        <div class="product-price">${formatCurrency(product.price)}</div>
                        <div class="product-stock ${product.stock > 10 ? '' : product.stock > 0 ? 'low' : 'out'}">
                            Stock: ${product.stock} unit
                        </div>
                        <div class="product-actions">
                            <button class="btn btn-primary btn-sm" ${product.stock <= 0 ? 'disabled' : ''} onclick="addToCart(${product.id}, '${product.name}', ${product.price}, ${product.stock})">Keranjang</button>
                            <button class="btn btn-secondary btn-sm" onclick="viewProduct(${product.id})">Detail</button>
                        </div>
                    </div>
                </div>
            `).join('');

            document.getElementById('products-container').innerHTML = html;
        }

        function renderPagination() {
            const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
            let html = '';

            if (currentPage > 1) {
                html += `<button onclick="goToPage(1)">Â« Pertama</button>`;
                html += `<button onclick="goToPage(${currentPage - 1})">â€¹ Sebelumnya</button>`;
            }

            for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) {
                if (i === currentPage) {
                    html += `<button class="active">${i}</button>`;
                } else {
                    html += `<button onclick="goToPage(${i})">${i}</button>`;
                }
            }

            if (currentPage < totalPages) {
                html += `<button onclick="goToPage(${currentPage + 1})">Berikutnya â€º</button>`;
                html += `<button onclick="goToPage(${totalPages})">Terakhir Â»</button>`;
            }

            document.getElementById('pagination').innerHTML = html;
        }

        function goToPage(page) {
            currentPage = page;
            renderProducts();
            renderPagination();
            window.scrollTo(0, 0);
        }

        function resetFilters() {
            document.getElementById('search-input').value = '';
            document.getElementById('sort-select').value = '';
            currentPage = 1;
            filteredProducts = allProducts;
            renderProducts();
            renderPagination();
        }

        function addToCart(id, name, price, stock) {
            if (stock <= 0) {
                alert('Produk sedang habis');
                return;
            }
            cartAPI.addToCart({ id, name, price, stock });
            updateCartCount();
            alert('Produk ditambahkan ke keranjang');
        }

        function viewProduct(id) {
            window.location.href = `/product-detail.html?id=${id}`;
        }

        function goToCart() {
            window.location.href = '/cart.html';
        }

        function updateCartCount() {
            document.getElementById('cart-count').textContent = cartAPI.getItemCount();
        }

        // Event listeners
        document.getElementById('search-input').addEventListener('input', filterAndSort);
        document.getElementById('sort-select').addEventListener('change', filterAndSort);

        // Initialize
        updateCartCount();
        loadProducts();
    </script>
</body>
</html>
