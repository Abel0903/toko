<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keranjang - TokoPro</title>
    <link rel="stylesheet" href="assets/style.css">
</head>
<body>
    <!-- Header -->
    <header>
        <nav>
            <a href="/" class="logo">TokoPro</a>
            <ul class="nav-links">
                <li><a href="/">Beranda</a></li>
                <li><a href="/products.html">Produk</a></li>
                <li><a href="/about.html">Tentang</a></li>
                <li><a href="/contact.html">Kontak</a></li>
            </ul>
            <div class="auth-buttons">
                <button class="btn btn-secondary" onclick="window.location.href='/login.html'">Login</button>
            </div>
        </nav>
    </header>

    <div class="container" style="padding: 2rem 0; margin-bottom: 3rem;">
        <h1 style="margin-bottom: 2rem;">ðŸ›’ Keranjang Belanja</h1>

        <div class="flex gap-6" style="flex-wrap: wrap;">
            <!-- Cart Items -->
            <div style="flex: 3; min-width: 300px;">
                <div id="cart-items"></div>
            </div>

            <!-- Cart Summary -->
            <div style="flex: 1; min-width: 250px;">
                <div class="card">
                    <div class="card-header">
                        <h3 style="margin: 0;">Ringkasan Pesanan</h3>
                    </div>
                    <div class="card-body">
                        <div class="flex-between" style="margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid #e5e7eb;">
                            <span>Subtotal:</span>
                            <span id="subtotal">Rp 0</span>
                        </div>
                        <div class="flex-between" style="margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid #e5e7eb;">
                            <span>Ongkos Kirim:</span>
                            <span id="shipping">Gratis</span>
                        </div>
                        <div class="flex-between" style="margin-bottom: 1rem; font-weight: 700; font-size: 1.25rem;">
                            <span>Total:</span>
                            <span id="total">Rp 0</span>
                        </div>
                        <button class="btn btn-primary btn-block btn-lg" onclick="checkout()">Lanjut ke Pembayaran</button>
                        <button class="btn btn-secondary btn-block" onclick="window.location.href='/products.html'" style="margin-top: 0.5rem;">Lanjut Belanja</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer style="background: #1f2937; color: white; padding: 2rem; text-align: center;">
        <p>&copy; 2024 TokoPro. Semua hak dilindungi.</p>
    </footer>

    <script src="assets/api.js"></script>
    <script>
        function renderCart() {
            const cart = cartAPI.getCart();

            if (cart.length === 0) {
                document.getElementById('cart-items').innerHTML = `
                    <div class="card" style="padding: 2rem; text-align: center;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">ðŸ›’</div>
                        <p>Keranjang Anda kosong</p>
                        <a href="/products.html" class="btn btn-primary" style="margin-top: 1rem;">Mulai Belanja</a>
                    </div>
                `;
                updateSummary();
                return;
            }

            const html = cart.map(item => `
                <div class="card" style="margin-bottom: 1rem;">
                    <div class="card-body">
                        <div class="flex-between" style="margin-bottom: 1rem;">
                            <div>
                                <h3 style="margin: 0 0 0.5rem 0;">${item.name}</h3>
                                <p style="margin: 0; color: #6b7280;">Price: ${formatCurrency(item.price)}</p>
                            </div>
                            <button class="btn btn-danger btn-sm" onclick="removeFromCart(${item.id})">Hapus</button>
                        </div>
                        <div class="flex-between" style="align-items: center;">
                            <div class="flex gap-2" style="align-items: center;">
                                <button class="btn btn-secondary btn-sm" onclick="decreaseQuantity(${item.id})">-</button>
                                <input type="number" min="1" max="${item.stock}" value="${item.quantity}" onchange="updateQuantity(${item.id}, this.value)" style="width: 60px; padding: 0.5rem; text-align: center; border: 1px solid #e5e7eb; border-radius: 0.375rem;">
                                <button class="btn btn-secondary btn-sm" onclick="increaseQuantity(${item.id})">+</button>
                            </div>
                            <div style="text-align: right;">
                                <p style="margin: 0; font-weight: 600;">${formatCurrency(item.price * item.quantity)}</p>
                                <p style="margin: 0; font-size: 0.875rem; color: #6b7280;">Stock tersedia: ${item.stock}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

            document.getElementById('cart-items').innerHTML = html;
            updateSummary();
        }

        function updateSummary() {
            const total = cartAPI.getTotal();
            document.getElementById('subtotal').textContent = formatCurrency(total);
            document.getElementById('total').textContent = formatCurrency(total);
        }

        function removeFromCart(id) {
            if (confirm('Hapus produk dari keranjang?')) {
                cartAPI.removeFromCart(id);
                renderCart();
            }
        }

        function updateQuantity(id, quantity) {
            cartAPI.updateQuantity(id, parseInt(quantity));
            renderCart();
        }

        function increaseQuantity(id) {
            const cart = cartAPI.getCart();
            const item = cart.find(i => i.id === id);
            if (item && item.quantity < item.stock) {
                cartAPI.updateQuantity(id, item.quantity + 1);
                renderCart();
            }
        }

        function decreaseQuantity(id) {
            const cart = cartAPI.getCart();
            const item = cart.find(i => i.id === id);
            if (item && item.quantity > 1) {
                cartAPI.updateQuantity(id, item.quantity - 1);
                renderCart();
            }
        }

        function checkout() {
            if (!authAPI.isLoggedIn()) {
                alert('Silakan login terlebih dahulu');
                window.location.href = '/login.html';
                return;
            }

            const cart = cartAPI.getCart();
            if (cart.length === 0) {
                alert('Keranjang kosong');
                return;
            }

            window.location.href = '/checkout.html';
        }

        // Initialize
        renderCart();
    </script>
</body>
</html>
